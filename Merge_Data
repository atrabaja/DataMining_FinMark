# ===== Step 1: Import Required Libraries =====
import pandas as pd

# ===== Step 2: Load Processed Datasets =====
# Load the cleaned datasets
transaction_summary = pd.read_csv("C:\\Users\\Angel Rabaja\\FinMark\\transaction_summary_cleaned.csv")
product_offering_data = pd.read_csv("C:\\Users\\Angel Rabaja\\FinMark\\product_offering_cleaned.csv")
customer_feedback_data = pd.read_csv("C:\\Users\\Angel Rabaja\\FinMark\\customer_feedback_cleaned.csv")

# ===== Step 3: Merge Customer Feedback and Transaction Summary =====
# Merge customer feedback data with transaction summary using Customer_ID
customer_data = pd.merge(customer_feedback_data, transaction_summary, on='Customer_ID', how='left')

# Explanation:
# - Performs a left join to ensure all customers in the feedback dataset are retained.
# - Customers without transaction data will have missing values in the transaction-related fields.

# ===== Step 4: Handle Missing Values After Merge =====
# Fill missing values in transaction features with 0 (indicating no transactions)
customer_data[['Total_Transaction_Amount', 'Avg_Transaction_Amount', 'Transaction_Count']] = customer_data[
    ['Total_Transaction_Amount', 'Avg_Transaction_Amount', 'Transaction_Count']
].fillna(0)

# Explanation:
# - Ensures customers without transactions are represented with zeros in the transaction-related columns.

# ===== Step 5: Merge Product Offering Data (if applicable) =====
# If product-related data is needed, you can merge it here (optional)
# For example, you could merge on Product_ID or other relevant keys
# Note: Ensure keys like Product_ID exist in both datasets
# customer_data = pd.merge(customer_data, product_offering_data, on='Product_ID', how='left')

# Explanation:
# - This step is optional and depends on whether product-level details are relevant to the analysis.

# ===== Step 6: Remove Duplicates =====
# Remove any duplicate rows if present
customer_data.drop_duplicates(inplace=True)

# ===== Step 7: Save Merged Dataset =====
# Save the merged dataset as a CSV file for further analysis
customer_data.to_csv("C:\\Users\\Angel Rabaja\\FinMark\\merged_customer_data.csv", index=False)

# Output the first few rows of the merged dataset
print("Merged Customer Data:")
print(customer_data.head())
