# Import libraries
import pandas as pd

# Input csv file
transaction_data = pd.read_csv("C:\\Users\\Angel Rabaja\\FinMark\\customer_transactions_contaminated.csv")

# Handle missing values for Transaction Amount
transaction_data['Transaction_Amount'] = transaction_data['Transaction_Amount'].fillna(transaction_data['Transaction_Amount'].median())

# Detect and handle outliers using IQR method
Q1 = transaction_data['Transaction_Amount'].quantile(0.25)
Q3 = transaction_data['Transaction_Amount'].quantile(0.75)
IQR = Q3 - Q1
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR
transaction_data['Transaction_Amount'] = transaction_data['Transaction_Amount'].apply(lambda x: min(x, upper_bound))

# Feature engineering
# Aggregating transactions per customer
transaction_summary = transaction_data.groupby('Customer_ID').agg(
    Total_Transaction_Amount=('Transaction_Amount', 'sum'),
    Avg_Transaction_Amount=('Transaction_Amount', 'mean'),
    Transaction_Count=('Transaction_ID', 'count')
).reset_index()

# Output cleaned data
print(transaction_summary.head())
